<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Notepal : Jupiter System - Collaborative Editing - Applied to Sticky Notes" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Notepal - Communication Protocol</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Aldream/notepal">View on GitHub</a>

          <h1 id="project_title"><a href="index.html" style="color:#fff;">Notepal</a></h1>
          <h2 id="project_tagline">Jupiter System - Collaborative Editing - Applied to Sticky Notes</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Aldream/notepal/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Aldream/notepal/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
		  
<p>Because of the central position of the server in this architecture, communications are only done between each client and the server.</p>

<p>Messages come from both side: from the client when it is connecting/fetching the data and when it is emitting an operation ; and from the server when it is broadcasting those operations to every other client.
This means that a socket must be kept open constantly between each client and the server. We will thus use the <em>Websocket</em> technology, through the <em>Socket.io</em> library.</p>

<p>We distinguish 3 kind of messages in our system: <em>Connection</em>, <em>Operation</em> and <em>Disconnection</em>.</p>

<h3 id="connection">Connection</h3>

<p>This message is automatically send to the server when the client wants to initiate a connection through the <em>Websocket</em>, allowing to create the socket server-side.</p>

<p>In return, the client receives form the server the current version of the shared data and a list of the already-connected users.</p>

<h4 id="formatofthemessage">Format of the message</h4>

<h5 id="connectionrequest">Connection Request</h5>

<p>Automatically generated by Socket.io</p>

<h5 id="repliesbytheserver">Replies by the server</h5>

<ul>
<li><span>Message <code>data</code>, containing the whole up-to-date data handled by the Jupiter System:</span>

<p><code>{ data: jupiterData }</code></p></li>
<li><span>Message <code>hi</code>, containing the list of already-connected users:</span>

<p><code>[ { id: socketId1, username: username1 }, { id: socketId2, username: username1 }, , { id: socketId3, username: username2 }, ... , {id: socketIdp, username: usernamen } ]</code></p></li>
</ul>

<h3 id="disconnection">Disconnection</h3>

<p>This message is automatically send to the server when the client disconnects for any reason (network problem, leaving the page, reloading, ...).
When receiving this message, the server desallocates all resources for this user.</p>

<h4 id="formatofthemessage">Format of the message</h4>

<p>Automatically generated by Socket.io, and of course no response.</p>

<h3 id="operation">Operation</h3>

<p>This message can be sent by the client to the server or by the server to the client.</p>

<p>An operation is generated by the client's application when a local operation is done.</p>

<h4 id="formatofthemessage">Format of the message</h4>

<ul>
<li><span>Message <code>op</code> from the client, containing the description of the operation:</span>

<p><code>{ op: &lt;name of the op (sIns, sDel, ...)&gt;, param: { &lt;param of the op&gt;} }</code></p></li>
<li><span>Message <code>op</code> from the server, containing the description of the operation and the id of the client responsible for it:</span>

<p><code>{ sender: idClient, msg: { op: &lt;name of the op (sIns, sDel, ...)&gt;, param: { &lt;param of the op&gt;} } }</code></p></li>
</ul>

<h3 id="joinleave">Join / Leave</h3>

<p>When the server notices a connection or disconnection of one of the client, it sends a notification to the other clients so they can update their list of connected clients/users.</p>

<h4 id="formatofthemessage">Format of the message</h4>

<ul>
<li><span>Message <code>hi</code> to welcome a new client, broadcasted to every other clients:</span>

<p><code>[{id: socketId, username: username}]</code></p></li>
<li><span>Message <code>bye</code> to notify the remaining clients of the disconnection of one of them:</span>

<p><code>{id: socketId}</code></p></li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Notepal maintained by <a href="https://github.com/Aldream">Aldream</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
